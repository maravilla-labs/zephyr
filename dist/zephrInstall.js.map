{"version":3,"file":"zephrInstall.js","sources":["../lib/zephrInstall.js"],"sourcesContent":["/**\n * Zephyr - Client-side Installation & API\n *\n * @version 0.2.0\n * @license Apache-2.0\n * @copyright 2019-2025 SOLUTAS GmbH\n * @see https://github.com/maravilla-labs/zephyr\n */\n\n(function() {\n  'use strict';\n\n  if (!('serviceWorker' in navigator)) {\n    console.warn('[Zephyr] Service Workers are not supported in this browser');\n    return;\n  }\n\n  if (!window.isSecureContext) {\n    console.warn('[Zephyr] Service Workers require a secure context (HTTPS or localhost)');\n    return;\n  }\n\n  function sendMessage(action, data = {}) {\n    return new Promise((resolve, reject) => {\n      if (!navigator.serviceWorker.controller) {\n        reject(new Error('Service worker not active'));\n        return;\n      }\n\n      const messageChannel = new MessageChannel();\n      messageChannel.port1.onmessage = (event) => resolve(event.data);\n\n      navigator.serviceWorker.controller.postMessage(\n        { action, ...data },\n        [messageChannel.port2]\n      );\n\n      setTimeout(() => reject(new Error('Service worker response timeout')), 5000);\n    });\n  }\n\n  const zephyr = {\n    /**\n     * Clear all cached entries\n     * @returns {Promise<boolean>}\n     */\n    clear: function() {\n      return sendMessage('clear');\n    },\n\n    /**\n     * Clear/invalidate cached entries matching a URL pattern\n     * @param {string} pattern - Regex pattern to match URLs\n     * @returns {Promise<number>} Number of entries deleted\n     */\n    clearPattern: function(pattern) {\n      return sendMessage('clearPattern', { pattern });\n    },\n\n    /**\n     * Alias for clearPattern - invalidate by regex pattern\n     * @param {string} pattern - Regex pattern to match URLs\n     * @returns {Promise<number>}\n     */\n    invalidate: function(pattern) {\n      return sendMessage('invalidate', { pattern });\n    },\n\n    /**\n     * Invalidate a specific URL\n     * @param {string} url - URL to invalidate\n     * @returns {Promise<boolean>}\n     */\n    invalidateUrl: function(url) {\n      return sendMessage('invalidateUrl', { url });\n    },\n\n    /**\n     * Get cache statistics\n     * @returns {Promise<Object>}\n     */\n    stats: function() {\n      return sendMessage('stats');\n    },\n\n    /**\n     * Get quota usage information\n     * @returns {Promise<Object>}\n     */\n    quota: function() {\n      return sendMessage('quota');\n    },\n\n    /**\n     * Toggle debug mode\n     * @returns {Promise<{debugMode: boolean}>}\n     */\n    debug: function() {\n      return sendMessage('debug');\n    },\n\n    /**\n     * Check if service worker is ready\n     * @returns {Promise<boolean>}\n     */\n    ready: function() {\n      return navigator.serviceWorker.ready.then(() => true);\n    },\n\n    /**\n     * Listen for quota warning events from service worker\n     * @param {function} callback - Called with {percentage, used, max}\n     */\n    onQuotaWarning: function(callback) {\n      navigator.serviceWorker.addEventListener('message', (event) => {\n        if (event.data?.type === 'zephyr-quota-warning') {\n          callback({\n            percentage: event.data.percentage,\n            used: event.data.used,\n            max: event.data.max\n          });\n        }\n      });\n    },\n\n    /**\n     * Manually prefetch a URL\n     * @param {string} url - URL to prefetch\n     * @returns {Promise<Object>} Prefetch result\n     */\n    prefetch: function(url) {\n      return sendMessage('prefetch', { url });\n    },\n\n    /**\n     * Listen for precache completion events\n     * @param {function} callback - Called with {succeeded, failed, total}\n     */\n    onPrecacheComplete: function(callback) {\n      navigator.serviceWorker.addEventListener('message', (event) => {\n        if (event.data?.type === 'zephyr-precache-complete') {\n          callback({\n            succeeded: event.data.succeeded,\n            failed: event.data.failed,\n            total: event.data.total\n          });\n        }\n      });\n    }\n  };\n\n  // ============================================================================\n  // Link Prediction (Prefetch on Hover/Touch)\n  // ============================================================================\n\n  /**\n   * ZephyrLinkPredictor - Prefetch URLs on hover/touch\n   */\n  class ZephyrLinkPredictor {\n    constructor(config, rules) {\n      this.config = {\n        enabled: false,\n        scope: 'rules-only',\n        delay: 150,\n        triggers: ['mouseenter', 'touchstart'],\n        selector: 'a[href]',\n        maxConcurrent: 2,\n        respectDataSaver: true,\n        priority: 'low',\n        exclude: [],\n        ...config\n      };\n\n      this.rules = rules || [];\n      this.patterns = config?.patterns || [];\n      this.inFlight = new Set();\n      this.prefetched = new Set();\n      this.hoverTimers = new Map();\n      this.observer = null;\n      this.currentConcurrent = 0;\n      this.pendingQueue = [];\n\n      if (this.config.enabled) {\n        this.init();\n      }\n    }\n\n    init() {\n      // Check user preferences\n      if (this.shouldDisable()) {\n        console.log('[Zephyr] Link prediction disabled due to user preferences');\n        return;\n      }\n\n      // Observe existing links\n      this.observeLinks(document.body);\n\n      // Watch for new links (SPA support)\n      this.observer = new MutationObserver(mutations => {\n        mutations.forEach(mutation => {\n          mutation.addedNodes.forEach(node => {\n            if (node.nodeType === Node.ELEMENT_NODE) {\n              this.observeLinks(node);\n            }\n          });\n        });\n      });\n\n      this.observer.observe(document.body, {\n        childList: true,\n        subtree: true\n      });\n\n      console.log('[Zephyr] Link prediction initialized');\n    }\n\n    shouldDisable() {\n      // Check data-saver mode\n      if (this.config.respectDataSaver && navigator.connection?.saveData) {\n        return true;\n      }\n\n      // Check slow connection\n      if (navigator.connection?.effectiveType) {\n        const slowTypes = ['slow-2g', '2g'];\n        if (slowTypes.includes(navigator.connection.effectiveType)) {\n          return true;\n        }\n      }\n\n      return false;\n    }\n\n    observeLinks(root) {\n      const links = root.matches?.(this.config.selector)\n        ? [root]\n        : root.querySelectorAll?.(this.config.selector) || [];\n\n      links.forEach(link => {\n        if (link._zephyrObserved) return;\n        link._zephyrObserved = true;\n\n        this.config.triggers.forEach(trigger => {\n          link.addEventListener(trigger, this.handleTrigger.bind(this), { passive: true });\n\n          if (trigger === 'mouseenter') {\n            link.addEventListener('mouseleave', this.handleCancel.bind(this), { passive: true });\n          }\n        });\n      });\n    }\n\n    handleTrigger(event) {\n      const link = event.currentTarget;\n      const url = this.normalizeUrl(link.href);\n\n      if (!url || !this.shouldPrefetch(url)) {\n        return;\n      }\n\n      // Clear any existing timer for this element\n      this.clearTimer(link);\n\n      // Start debounce timer\n      const timer = setTimeout(() => {\n        this.prefetch(url);\n      }, this.config.delay);\n\n      this.hoverTimers.set(link, timer);\n    }\n\n    handleCancel(event) {\n      this.clearTimer(event.currentTarget);\n    }\n\n    clearTimer(link) {\n      const timer = this.hoverTimers.get(link);\n      if (timer) {\n        clearTimeout(timer);\n        this.hoverTimers.delete(link);\n      }\n    }\n\n    normalizeUrl(href) {\n      try {\n        const url = new URL(href, window.location.origin);\n        // Remove hash\n        url.hash = '';\n        return url.href;\n      } catch {\n        return null;\n      }\n    }\n\n    shouldPrefetch(url) {\n      // Already prefetched or in flight\n      if (this.prefetched.has(url) || this.inFlight.has(url)) {\n        return false;\n      }\n\n      // Check exclusion patterns\n      if (this.config.exclude.some(pattern => {\n        try {\n          return new RegExp(pattern).test(url);\n        } catch {\n          return false;\n        }\n      })) {\n        return false;\n      }\n\n      const urlObj = new URL(url);\n\n      // Same-origin check\n      if (urlObj.origin !== window.location.origin) {\n        return false;\n      }\n\n      // Scope check\n      if (this.config.scope === 'rules-only') {\n        return this.matchesRule(url) || this.matchesPattern(url);\n      }\n\n      return true; // same-origin scope\n    }\n\n    matchesRule(url) {\n      return this.rules.some(rule => {\n        try {\n          const regex = new RegExp(rule.test);\n          return regex.test(url) && (!rule.method || rule.method === 'GET');\n        } catch {\n          return false;\n        }\n      });\n    }\n\n    matchesPattern(url) {\n      return this.patterns.some(pattern => {\n        try {\n          const regex = new RegExp(pattern);\n          return regex.test(url);\n        } catch {\n          return false;\n        }\n      });\n    }\n\n    async prefetch(url) {\n      if (this.currentConcurrent >= this.config.maxConcurrent) {\n        this.pendingQueue.push(url);\n        return;\n      }\n\n      this.inFlight.add(url);\n      this.currentConcurrent++;\n\n      try {\n        // Send prefetch request to service worker\n        const result = await zephyr.prefetch(url);\n        this.prefetched.add(url);\n        return result;\n      } catch (error) {\n        console.log('[Zephyr] Prefetch failed:', url, error.message);\n      } finally {\n        this.inFlight.delete(url);\n        this.currentConcurrent--;\n        this.processQueue();\n      }\n    }\n\n    processQueue() {\n      while (this.pendingQueue.length > 0 && this.currentConcurrent < this.config.maxConcurrent) {\n        const url = this.pendingQueue.shift();\n        if (!this.prefetched.has(url)) {\n          this.prefetch(url);\n        }\n      }\n    }\n\n    destroy() {\n      if (this.observer) {\n        this.observer.disconnect();\n      }\n      this.hoverTimers.forEach(timer => clearTimeout(timer));\n      this.hoverTimers.clear();\n    }\n  }\n\n  // Store reference for external access\n  window.ZephyrLinkPredictor = ZephyrLinkPredictor;\n\n  window.zephyr = zephyr;\n\n  /**\n   * Initialize link prediction if configured\n   * @param {Object} config - Zephyr configuration object\n   */\n  function initLinkPrediction(config) {\n    if (!config?.eagerCache?.linkPrediction?.enabled) {\n      return null;\n    }\n\n    // Wait for SW to be ready\n    return navigator.serviceWorker.ready.then(() => {\n      const predictor = new ZephyrLinkPredictor(\n        {\n          ...config.eagerCache.linkPrediction,\n          patterns: config.eagerCache.precache?.patterns || []\n        },\n        config.rules\n      );\n      window.zephyrLinkPredictor = predictor;\n      return predictor;\n    });\n  }\n\n  window.addEventListener('load', function() {\n    navigator.serviceWorker\n      .register('./zephyrConfig.js', { scope: '/' })\n      .then(function(registration) {\n        console.log('[Zephyr] Service worker registered');\n\n        // Initialize link prediction if config is available on window\n        // Users should set window.zephyrConfig = { ... } before this script loads\n        if (window.zephyrConfig) {\n          initLinkPrediction(window.zephyrConfig);\n        }\n\n        registration.addEventListener('updatefound', function() {\n          const newWorker = registration.installing;\n          console.log('[Zephyr] New service worker installing...');\n\n          newWorker.addEventListener('statechange', function() {\n            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {\n              console.log('[Zephyr] New version available. Refresh to update.');\n            }\n          });\n        });\n      })\n      .catch(function(error) {\n        console.error('[Zephyr] Registration failed:', error.message);\n        if (error.message.includes('SSL')) {\n          console.error('[Zephyr] Hint: Service workers require HTTPS');\n        }\n      });\n  });\n\n  // Export initLinkPrediction for manual initialization\n  window.zephyrInitLinkPrediction = initLinkPrediction;\n})();\n"],"names":["sendMessage","action","data","resolve","reject","messageChannel","event","zephyr","pattern","url","callback","_a","ZephyrLinkPredictor","config","rules","mutations","mutation","node","_b","root","link","trigger","timer","href","rule","result","error","initLinkPrediction","predictor","registration","newWorker"],"mappings":"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"}